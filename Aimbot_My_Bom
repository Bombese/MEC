-- ===== Services & LocalPlayer =====
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- ===== ScreenGui =====
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "BomHackGUI"
gui.ResetOnSpawn = false

-- ===== Main Frame =====
local main = Instance.new("Frame")
main.Size = UDim2.new(0, 550, 0, 350)
main.Position = UDim2.new(0.5, -275, 0.5, -175)
main.BackgroundColor3 = Color3.fromRGB(35,35,35)
main.BackgroundTransparency = 0.1
main.BorderSizePixel = 0
main.Parent = gui

local corner = Instance.new("UICorner", main)
corner.CornerRadius = UDim.new(0, 14)

-- ===== Shadow =====
local shadow = Instance.new("ImageLabel", main)
shadow.Name = "Shadow"
shadow.AnchorPoint = Vector2.new(0.5,0.5)
shadow.Position = UDim2.new(0.5,0,0.5,0)
shadow.Size = UDim2.new(1,60,1,60)
shadow.BackgroundTransparency = 1
shadow.Image = "rbxassetid://1316045217"
shadow.ImageTransparency = 0.85
shadow.ZIndex = -1

-- ===== Close Button =====
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0,30,0,30)
closeBtn.Position = UDim2.new(1,-35,0,5)
closeBtn.BackgroundColor3 = Color3.fromRGB(200,0,0)
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.new(1,1,1)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 18
closeBtn.BorderSizePixel = 0
closeBtn.Parent = main

local btnCorner = Instance.new("UICorner", closeBtn)
btnCorner.CornerRadius = UDim.new(0,6)

closeBtn.MouseEnter:Connect(function() closeBtn.BackgroundColor3 = Color3.fromRGB(255,50,50) end)
closeBtn.MouseLeave:Connect(function() closeBtn.BackgroundColor3 = Color3.fromRGB(200,0,0) end)
closeBtn.MouseButton1Click:Connect(function() main.Visible = false end)

-- ===== Hack Speed =====
local hackLabel = Instance.new("TextLabel")
hackLabel.Size = UDim2.new(0,150,0,30)
hackLabel.Position = UDim2.new(0,20,0,10)
hackLabel.BackgroundTransparency = 1
hackLabel.Text = "Hack Speed:"
hackLabel.TextColor3 = Color3.new(1,1,1)
hackLabel.Font = Enum.Font.GothamBold
hackLabel.TextSize = 20
hackLabel.TextXAlignment = Enum.TextXAlignment.Left
hackLabel.Parent = main

local speedBox = Instance.new("TextBox")
speedBox.Size = UDim2.new(0,100,0,30)
speedBox.Position = UDim2.new(0,20,0,50)
speedBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
speedBox.TextColor3 = Color3.new(1,1,1)
speedBox.Text = "16"
speedBox.PlaceholderText = "Speed"
speedBox.ClearTextOnFocus = false
speedBox.Font = Enum.Font.Gotham
speedBox.TextSize = 18
speedBox.BorderSizePixel = 0
speedBox.Parent = main

local speedCorner = Instance.new("UICorner", speedBox)
speedCorner.CornerRadius = UDim.new(0,6)

local applyBtn = Instance.new("TextButton")
applyBtn.Size = UDim2.new(0,80,0,30)
applyBtn.Position = UDim2.new(0,130,0,50)
applyBtn.BackgroundColor3 = Color3.fromRGB(0,150,255)
applyBtn.TextColor3 = Color3.new(1,1,1)
applyBtn.Text = "Apply"
applyBtn.Font = Enum.Font.GothamBold
applyBtn.TextSize = 18
applyBtn.BorderSizePixel = 0
applyBtn.Parent = main

local applyCorner = Instance.new("UICorner", applyBtn)
applyCorner.CornerRadius = UDim.new(0,6)

applyBtn.MouseEnter:Connect(function() applyBtn.BackgroundColor3 = Color3.fromRGB(50,180,255) end)
applyBtn.MouseLeave:Connect(function() applyBtn.BackgroundColor3 = Color3.fromRGB(0,150,255) end)
applyBtn.MouseButton1Click:Connect(function()
    local speed = tonumber(speedBox.Text)
    if speed and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
        LocalPlayer.Character:FindFirstChildOfClass("Humanoid").WalkSpeed = speed
    end
end)

-- ===== Aim Bot =====
local lockCircle = Instance.new("Frame")
lockCircle.Size = UDim2.new(0,150,0,150)
lockCircle.Position = UDim2.new(0.5,-75,0.5,-75)
lockCircle.BackgroundTransparency = 1
lockCircle.Parent = gui

local circleStroke = Instance.new("UIStroke")
circleStroke.Color = Color3.fromRGB(0,255,0)
circleStroke.Thickness = 2
circleStroke.Parent = lockCircle

local circleCorner = Instance.new("UICorner")
circleCorner.CornerRadius = UDim.new(1,0)
circleCorner.Parent = lockCircle

local aimEnabled = false
local aimBtn = Instance.new("TextButton")
aimBtn.Size = UDim2.new(0,100,0,30)
aimBtn.Position = UDim2.new(0,20,0,100)
aimBtn.BackgroundColor3 = Color3.fromRGB(255,150,0)
aimBtn.TextColor3 = Color3.new(1,1,1)
aimBtn.Text = "Lock Aim"
aimBtn.Font = Enum.Font.GothamBold
aimBtn.TextSize = 18
aimBtn.BorderSizePixel = 0
aimBtn.Parent = main

local aimCorner = Instance.new("UICorner", aimBtn)
aimCorner.CornerRadius = UDim.new(0,6)

aimBtn.MouseButton1Click:Connect(function()
    aimEnabled = not aimEnabled
    aimBtn.Text = aimEnabled and "Unlock Aim" or "Lock Aim"
end)

local function getClosestPlayerInCircle()
    local closestPlayer = nil
    local shortestDistance = math.huge
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return nil end
    local myPos = LocalPlayer.Character.HumanoidRootPart.Position

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local targetPos = player.Character.HumanoidRootPart.Position
            local screenPos, onScreen = camera:WorldToViewportPoint(targetPos)
            if onScreen then
                local centerX = camera.ViewportSize.X/2
                local centerY = camera.ViewportSize.Y/2
                local dx = screenPos.X - centerX
                local dy = screenPos.Y - centerY
                local distanceOnScreen = math.sqrt(dx*dx + dy*dy)
                if distanceOnScreen <= lockCircle.AbsoluteSize.X/2 then
                    local distanceToMe = (targetPos - myPos).Magnitude
                    if distanceToMe < shortestDistance then
                        shortestDistance = distanceToMe
                        closestPlayer = player
                    end
                end
            end
        end
    end
    return closestPlayer
end

RunService.RenderStepped:Connect(function()
    if aimEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local target = getClosestPlayerInCircle()
        if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
            camera.CFrame = camera.CFrame:Lerp(
                CFrame.new(camera.CFrame.Position, target.Character.HumanoidRootPart.Position),
                0.3
            )
        end
    end
end)

-- ===== Drag Main GUI =====
do
    local dragging = false
    local dragInput, mousePos, framePos

    local function update(input)
        local delta = input.Position - mousePos
        main.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
    end

    main.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            mousePos = input.Position
            framePos = main.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    main.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            update(input)
        end
    end)
end

-- ===== Open GUI Button =====
local openBtn = Instance.new("TextButton")
openBtn.Size = UDim2.new(0,80,0,30)
openBtn.Position = UDim2.new(0,20,0,20)
openBtn.BackgroundColor3 = Color3.fromRGB(0,150,255)
openBtn.TextColor3 = Color3.new(1,1,1)
openBtn.Text = "AimBotVip"
openBtn.Font = Enum.Font.GothamBold
openBtn.TextSize = 18
openBtn.BorderSizePixel = 0
openBtn.Parent = gui

local openCorner = Instance.new("UICorner", openBtn)
openCorner.CornerRadius = UDim.new(0,6)

openBtn.MouseEnter:Connect(function() openBtn.BackgroundColor3 = Color3.fromRGB(50,180,255) end)
openBtn.MouseLeave:Connect(function() openBtn.BackgroundColor3 = Color3.fromRGB(0,150,255) end)
openBtn.MouseButton1Click:Connect(function() main.Visible = true end)

-- ===== FPS Counter =====
local fpsLabel = Instance.new("TextLabel")
fpsLabel.Size = UDim2.new(0,100,0,30)
fpsLabel.Position = UDim2.new(1,-120,0,10)
fpsLabel.BackgroundTransparency = 0.5
fpsLabel.BackgroundColor3 = Color3.fromRGB(0,0,0)
fpsLabel.TextColor3 = Color3.fromRGB(0,255,0)
fpsLabel.Font = Enum.Font.GothamBold
fpsLabel.TextSize = 18
fpsLabel.Text = "FPS: 0"
fpsLabel.TextXAlignment = Enum.TextXAlignment.Left
fpsLabel.TextYAlignment = Enum.TextYAlignment.Center
fpsLabel.Parent = gui

local lastTime = tick()
local frameCount = 0
RunService.RenderStepped:Connect(function()
    frameCount += 1
    local now = tick()
    if now - lastTime >= 1 then
        fpsLabel.Text = "FPS: "..frameCount
        frameCount = 0
        lastTime = now
    end
end)

-- ===== ESP Names + Tracers =====
getgenv().ESPTracers = true
local espFolder = Instance.new("Folder", gui)
espFolder.Name = "ESPFolder"

local function CreateESP(player)
    if player == LocalPlayer then return end
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end

    -- Name Label ตรงกลางตัว
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(0,100,0,20)
    nameLabel.Position = UDim2.new(0,0,0.5,-10)
    nameLabel.AnchorPoint = Vector2.new(0.5,0.5)
    nameLabel.BackgroundTransparency = 1
    nameLabel.TextColor3 = Color3.fromRGB(0,255,0)
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextSize = 14
    nameLabel.Text = player.Name
    nameLabel.TextScaled = true
    nameLabel.Parent = espFolder

    -- Update position
    RunService.RenderStepped:Connect(function()
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local root = player.Character.HumanoidRootPart
            local screenPos, onScreen = camera:WorldToViewportPoint(root.Position)
            if onScreen then
                nameLabel.Position = UDim2.new(0, screenPos.X, 0, screenPos.Y)
                nameLabel.Visible = true
            else
                nameLabel.Visible = false
            end
        else
            nameLabel.Visible = false
        end
    end)

    -- Tracer Beam
    local function CreateBeam()
        if player == LocalPlayer then return end
        local targetChar = player.Character
        local localChar = LocalPlayer.Character
        if not targetChar or not targetChar:FindFirstChild("HumanoidRootPart") then return end
        if not localChar or not localChar:FindFirstChild("HumanoidRootPart") then return end

        if targetChar:FindFirstChild("ESPBeam") then
            targetChar.ESPBeam.Enabled = getgenv().ESPTracers
            return
        end

        local attachment0 = Instance.new("Attachment", localChar.HumanoidRootPart)
        local attachment1 = Instance.new("Attachment", targetChar.HumanoidRootPart)

        local beam = Instance.new("Beam")
        beam.Name = "ESPBeam"
        beam.Attachment0 = attachment0
        beam.Attachment1 = attachment1
        beam.Color = ColorSequence.new(Color3.fromRGB(255,0,0))
        beam.FaceCamera = true
        beam.Width0 = 0.15
        beam.Width1 = 0.15
        beam.Parent = targetChar
        beam.Enabled = getgenv().ESPTracers
    end
    CreateBeam()
end

-- สร้าง ESP สำหรับทุกผู้เล่น
for _, player in pairs(Players:GetPlayers()) do
    CreateESP(player)
    player.CharacterAdded:Connect(function()
        wait(0.5)
        CreateESP(player)
    end)
end

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        wait(0.5)
        CreateESP(player)
    end)
end)