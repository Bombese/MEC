--// WindUI - EMPTY UI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

--// Create Window
local Window = WindUI:CreateWindow({
    Title = "NOOBHUB",
    Icon = "monitor",
    Author = "Bom Bom",

    OpenButton = {
        Title = "Open UI",
        Icon = "menu",
        CornerRadius = UDim.new(0,16),
        StrokeThickness = 2,
        Enabled = true,
        Draggable = true,
    }
})
--// ===== Main Tab =====
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local TabMain = Window:Tab({
    Title = "Main",
    Icon = "eye"
})

TabMain:Select()

--// ESP Storage
local ESPEnabled = false
local ESPBoxes = {}

--// Create ESP Box
local function CreateESP(player)
    if player == LocalPlayer then return end

    local box = Drawing.new("Square")
    box.Thickness = 2
    box.Color = Color3.fromRGB(255, 0, 0)
    box.Transparency = 1
    box.Filled = false
    box.Visible = false

    ESPBoxes[player] = box
end

--// Remove ESP
local function RemoveESP(player)
    if ESPBoxes[player] then
        ESPBoxes[player]:Remove()
        ESPBoxes[player] = nil
    end
end

--// Update ESP
RunService.RenderStepped:Connect(function()
    if not ESPEnabled then
        for _,box in pairs(ESPBoxes) do
            box.Visible = false
        end
        return
    end

    for _,player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            local box = ESPBoxes[player] or CreateESP(player)

            local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
            if onScreen then
                local size = Vector2.new(40, 60)
                box.Size = size
                box.Position = Vector2.new(
                    pos.X - size.X / 2,
                    pos.Y - size.Y / 2
                )
                box.Visible = true
            else
                box.Visible = false
            end
        end
    end
end)

--// Player Join / Leave
Players.PlayerAdded:Connect(CreateESP)
Players.PlayerRemoving:Connect(RemoveESP)

--// Toggle ESP
TabMain:Toggle({
    Title = "ESP (Box)",
    Desc = "มองทะลุ + กรอบรอบตัวผู้เล่น",
    Value = false,
    Callback = function(v)
        ESPEnabled = v
    end
})
-- ===== SKELETON ESP (R6 + R15) =====

getgenv().SkeletonESP = false

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local Skeletons = {}

-- ===== Bones =====

local BonesR15 = {
    {"Head","UpperTorso"},
    {"UpperTorso","LowerTorso"},

    {"UpperTorso","LeftUpperArm"},
    {"LeftUpperArm","LeftLowerArm"},
    {"LeftLowerArm","LeftHand"},

    {"UpperTorso","RightUpperArm"},
    {"RightUpperArm","RightLowerArm"},
    {"RightLowerArm","RightHand"},

    {"LowerTorso","LeftUpperLeg"},
    {"LeftUpperLeg","LeftLowerLeg"},
    {"LeftLowerLeg","LeftFoot"},

    {"LowerTorso","RightUpperLeg"},
    {"RightUpperLeg","RightLowerLeg"},
    {"RightLowerLeg","RightFoot"},
}

local BonesR6 = {
    {"Head","Torso"},

    {"Torso","Left Arm"},
    {"Torso","Right Arm"},

    {"Torso","Left Leg"},
    {"Torso","Right Leg"},
}

-- ===== Functions =====

local function ClearSkeleton(plr)
    if Skeletons[plr] then
        for _,line in pairs(Skeletons[plr]) do
            line:Remove()
        end
        Skeletons[plr] = nil
    end
end

local function CreateSkeleton(plr, bones)
    Skeletons[plr] = {}

    for _ = 1,#bones do
        local line = Drawing.new("Line")
        line.Thickness = 1.5
        line.Color = Color3.fromRGB(0,255,170)
        line.Transparency = 1
        line.Visible = false
        table.insert(Skeletons[plr], line)
    end
end

-- ===== Render =====

RunService.RenderStepped:Connect(function()
    if not getgenv().SkeletonESP then
        for _,plr in pairs(Players:GetPlayers()) do
            ClearSkeleton(plr)
        end
        return
    end

    for _,plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            local char = plr.Character
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if not humanoid then continue end

            local bones = humanoid.RigType == Enum.HumanoidRigType.R15 and BonesR15 or BonesR6

            if not Skeletons[plr] then
                CreateSkeleton(plr, bones)
            end

            for i,bone in ipairs(bones) do
                local p1 = char:FindFirstChild(bone[1])
                local p2 = char:FindFirstChild(bone[2])
                local line = Skeletons[plr][i]

                if p1 and p2 then
                    local s1,v1 = Camera:WorldToViewportPoint(p1.Position)
                    local s2,v2 = Camera:WorldToViewportPoint(p2.Position)

                    if v1 and v2 then
                        line.From = Vector2.new(s1.X,s1.Y)
                        line.To   = Vector2.new(s2.X,s2.Y)
                        line.Visible = true
                    else
                        line.Visible = false
                    end
                else
                    line.Visible = false
                end
            end
        end
    end
end)

-- ===== UI =====
HackTab:Toggle({
    Title = "Skeleton ESP (R6 / R15)",
    Desc = "รองรับผู้เล่นทุก Rig",
    Value = false,
    Callback = function(v)
        getgenv().SkeletonESP = v
    end
})